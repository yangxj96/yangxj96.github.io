---
title: Winform在VS2022中操作注册表的ClassesRoot项提示权限不足
date: 2023-10-20 10:18:28
category: C系列语言
---

# 0 前言

在VS2022中的Winform项目中,使用 `Registry.ClassesRoot.CreateSubKey` 进行注册表相关操作的时候,提示权限不足的错误,但是在vs2022中没有了在属性中直接勾选安全的内容,同时在.NET 6中的Winform项目中,默认没有创建`app.manifest`文件,所以像我这样的新手会一下子手足无措,无法找到相应的页面进行处理

# 1 解决方式
> 手动创建`app.manifest`文件

1.1 创建`app.manifest`文件
![在这里插入图片描述](/images/blog/c/b-1-1.png)
![在这里插入图片描述](/images/blog/c/b-1-2.png)
> 默认名称就是`app.manifest`

1.2 修改权限

文件的权限注释中已经说明了.
把原来的`<requestedExecutionLevel level="asInvoker" uiAccess="false" />` 替换为`<requestedExecutionLevel  level="requireAdministrator" uiAccess="false" />`即可.
替换后进行编译运行,会提示你以管理员的方式重启VS,重启后既可以正常操作`ClassesRoot`相关的注册表内容.而且应用也会多一个管理员的标识.如下所示

![在这里插入图片描述](/images/blog/c/b-1-3.png)
### 修改后的文件 ↓

```xml
<?xml version="1.0" encoding="utf-8"?>
<assembly manifestVersion="1.0" xmlns="urn:schemas-microsoft-com:asm.v1">
	<assemblyIdentity version="1.0.0.0" name="MyApplication.app"/>
	<trustInfo xmlns="urn:schemas-microsoft-com:asm.v2">
		<security>
			<requestedPrivileges xmlns="urn:schemas-microsoft-com:asm.v3">
				<!-- UAC 清单选项
             如果想要更改 Windows 用户帐户控制级别，请使用
             以下节点之一替换 requestedExecutionLevel 节点。

        <requestedExecutionLevel  level="asInvoker" uiAccess="false" />
        <requestedExecutionLevel  level="requireAdministrator" uiAccess="false" />
        <requestedExecutionLevel  level="highestAvailable" uiAccess="false" />

            指定 requestedExecutionLevel 元素将禁用文件和注册表虚拟化。
            如果你的应用程序需要此虚拟化来实现向后兼容性，则移除此
            元素。
        -->
				<!--<requestedExecutionLevel level="asInvoker" uiAccess="false" />-->
				<requestedExecutionLevel  level="requireAdministrator" uiAccess="false" />
			</requestedPrivileges>
		</security>
	</trustInfo>

	<compatibility xmlns="urn:schemas-microsoft-com:compatibility.v1">
		<application>
			<!-- 设计此应用程序与其一起工作且已针对此应用程序进行测试的
           Windows 版本的列表。取消评论适当的元素，
           Windows 将自动选择最兼容的环境。 -->

			<!-- Windows Vista -->
			<!--<supportedOS Id="{e2011457-1546-43c5-a5fe-008deee3d3f0}" />-->

			<!-- Windows 7 -->
			<!--<supportedOS Id="{35138b9a-5d96-4fbd-8e2d-a2440225f93a}" />-->

			<!-- Windows 8 -->
			<!--<supportedOS Id="{4a2f28e3-53b9-4441-ba9c-d69d4a4a6e38}" />-->

			<!-- Windows 8.1 -->
			<!--<supportedOS Id="{1f676c76-80e1-4239-95bb-83d0f6d0da78}" />-->

			<!-- Windows 10 -->
			<!--<supportedOS Id="{8e0f7a12-bfb3-4fe8-b9a5-48fd50a15a9a}" />-->

		</application>
	</compatibility>

	<!-- 指示该应用程序可感知 DPI 且 Windows 在 DPI 较高时将不会对其进行
       自动缩放。Windows Presentation Foundation (WPF)应用程序自动感知 DPI，无需
       选择加入。选择加入此设置的 Windows 窗体应用程序(面向 .NET Framework 4.6)还应
       在其 app.config 中将 "EnableWindowsFormsHighDpiAutoResizing" 设置设置为 "true"。
       
       将应用程序设为感知长路径。请参阅 https://docs.microsoft.com/windows/win32/fileio/maximum-file-path-limitation -->
	<!--
  <application xmlns="urn:schemas-microsoft-com:asm.v3">
    <windowsSettings>
      <dpiAware xmlns="http://schemas.microsoft.com/SMI/2005/WindowsSettings">true</dpiAware>
      <longPathAware xmlns="http://schemas.microsoft.com/SMI/2016/WindowsSettings">true</longPathAware>
    </windowsSettings>
  </application>
  -->

	<!-- 启用 Windows 公共控件和对话框的主题(Windows XP 和更高版本) -->
	<!--
  <dependency>
    <dependentAssembly>
      <assemblyIdentity
          type="win32"
          name="Microsoft.Windows.Common-Controls"
          version="6.0.0.0"
          processorArchitecture="*"
          publicKeyToken="6595b64144ccf1df"
          language="*"
        />
    </dependentAssembly>
  </dependency>
  -->

</assembly>

```

